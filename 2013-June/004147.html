<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [eLua-dev] New to eLua and STM32F4xx
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/elua-dev/2013-June/index.html" >
   <LINK REL="made" HREF="mailto:elua-dev%40lists.berlios.de?Subject=Re%3A%20%5BeLua-dev%5D%20New%20to%20eLua%20and%20STM32F4xx&In-Reply-To=%3CCANKDJfZBmWMdCCH867bzr0tOhDO2%2Bo2zco%2BHYEsvAdu997ru9w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004146.html">
   <LINK REL="Next"  HREF="004150.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[eLua-dev] New to eLua and STM32F4xx</H1>
    <B>Bogdan Marinescu</B> 
    <A HREF="mailto:elua-dev%40lists.berlios.de?Subject=Re%3A%20%5BeLua-dev%5D%20New%20to%20eLua%20and%20STM32F4xx&In-Reply-To=%3CCANKDJfZBmWMdCCH867bzr0tOhDO2%2Bo2zco%2BHYEsvAdu997ru9w%40mail.gmail.com%3E"
       TITLE="[eLua-dev] New to eLua and STM32F4xx">bogdan.marinescu at gmail.com
       </A><BR>
    <I>Mon Jun  3 20:22:38 CEST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="004146.html">[eLua-dev] New to eLua and STM32F4xx
</A></li>
        <LI>Next message: <A HREF="004150.html">[eLua-dev] New to eLua and STM32F4xx
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4147">[ date ]</a>
              <a href="thread.html#4147">[ thread ]</a>
              <a href="subject.html#4147">[ subject ]</a>
              <a href="author.html#4147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Jun 3, 2013 at 8:28 PM, James Snyder &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">jbsnyder at fanplastic.org</A>&gt;wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mon, Jun 3, 2013 at 2:03 AM, Bogdan Marinescu &lt;
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">bogdan.marinescu at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, Jun 3, 2013 at 4:49 AM, Graham Henstridge &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">graham at capgo.com</A>&gt;wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I have been following eLua for a while with the aim of deploying it on a
</I>&gt;&gt;&gt;<i> custom STM32F4xx project. I have successfully built the STM32F407_Discovery
</I>&gt;&gt;&gt;<i> image with the now obsolete &quot;scons&quot; based builder, but have not yet been
</I>&gt;&gt;&gt;<i> successful with the new &quot;lake&quot; builder. I am not too worried about that at
</I>&gt;&gt;&gt;<i> the moment as I have not spent much time on it. But I do have some basic
</I>&gt;&gt;&gt;<i> questions to get a feel for where eLua is going:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1. Lua 5.1 is specified for eLua. Using Lua 5.2 may be the cause of my
</I>&gt;&gt;&gt;<i> present problems. Is Lua 5.2 supported and if not is it intended to do so
</I>&gt;&gt;&gt;<i> soon? Moving to a total Lua build system makes sense, but staying at Lua
</I>&gt;&gt;&gt;<i> 5.1 does not!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Lua 5.1 is far from being obsolete and a lot of projects centered around
</I>&gt;&gt;<i> Lua still use Lua 5.1. There are plans to move eLua to 5.2 at some point,
</I>&gt;&gt;<i> but nothing very clear at the moment.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 2. The STM32F4xx branch has been around for a while (although not on
</I>&gt;&gt;&gt;<i> main git until very recently) and has not been merged with Master yet. Can
</I>&gt;&gt;&gt;<i> anyone comment on its status?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Check the new 'stm32f4' branch on github, this is where the STM32F4
</I>&gt;&gt;<i> development is currently happening. After some testing, it will be merged
</I>&gt;&gt;<i> to master.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On this front if you're using the discovery board you might need to use
</I>&gt;<i> the bikeNomad-master branch or have one of us commit a fix to put the UART
</I>&gt;<i> back on PB6/7 for that board (
</I>&gt;<i> <A HREF="https://github.com/jsnyder/elua/tree/bikeNomad-master">https://github.com/jsnyder/elua/tree/bikeNomad-master</A>).  I'll try and put
</I>&gt;<i> this fix in the 'stm32f4' branch and test it (on the board, PA9 is
</I>&gt;<i> connected to VBUS for USB and an LED, not sure if it it can be used as a
</I>&gt;<i> UART.
</I>&gt;<i>
</I>
It's almost certainly unusable as an UART.
One thing we can do before eLua gets the proper uart_set_pins() function is
to use the configurator and add a platform-specific configuration.
Something like this:

-- Add specific configuration to the 'configs' table
function add_platform_configs( t, board, cpu )
  t.stm32f4_uart_pins = {
    attrs = {
      con_rx_port = at.int_attr( 'STM32F4_CON_RX_PORT', 0 ),
      con_rx_pin = at.int_attr( 'STM32F4_CON_RX_PIN', 0 ),
      con_tx_port = at.int_attr( 'STM32F4_CON_TX_PORT', 0 ),
      con_tx_pin = at.int_attr( 'STM32F4_CON_TX_PIN', 0 )
    },
    required = { con_rx_port = 1, con_rx_pin = 7, con_tx_port = 1,
con_tx_pin = 6 } -- this is the default configuration
  }
end

Then each board description file will be able to supply its own pin
configuration for the console UART. Of course, this still needs support in
platform.c, but that should be fairly easy. Let me know if you're OK with
this solution.



&gt;<i>
</I>&gt;<i> Another thing might be if you switch to the stm32f4 branch it will try to
</I>&gt;<i> build with hardware floating point, depending on your toolchain you might
</I>&gt;<i> run into linking errors about VFP, depending on the toolchain you're using
</I>&gt;<i> and if it includes the right libraries or multilibs. If you're using my
</I>&gt;<i> Makefile (arm-eabi-toolchain), I have a version that seems to be working in
</I>&gt;<i> a branch, but I haven't pushed it to master yet.
</I>&gt;<i>
</I>
I recommend this:

<A HREF="https://launchpad.net/gcc-arm-embedded/+milestone/4.7-2012-q4-major">https://launchpad.net/gcc-arm-embedded/+milestone/4.7-2012-q4-major</A>

It works very well, the multilib configuration is complete and it has a Mac
version.

Best,
Bogdan


&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 3. My working platform is a Mac. Are there any known issues in building
</I>&gt;&gt;&gt;<i> eLua on a Mac? So far I have not discovered any.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> None that I know of, but personally I never tried to build eLua on a Mac.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It should be fine on Mac OS X.  That's what I use for development.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 4. Present issue is with require&quot;lfs&quot; not accepting lfs.so. Paths are
</I>&gt;&gt;&gt;<i> ok. Suspecting Lua versions. Comments anyone?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is quite strange. How are you installing lfs on your machine? What
</I>&gt;&gt;<i> is the value of your LUA_PATH environment variable?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You'll want to use 5.1 on your machine for building I think (as Bjorn was
</I>&gt;<i> discussing what might happen with 5.2).  I don't know that any of us have
</I>&gt;<i> tested the build system with 5.2.
</I>&gt;<i>
</I>&gt;<i> I believe on my system I've got lua and luarocks installed out of Homebrew
</I>&gt;<i> (which defaults to 5.1.x, <A HREF="https://github.com/mxcl/homebrew/">https://github.com/mxcl/homebrew/</A>) and then
</I>&gt;<i> used luarocks to install the needed modules like lfs.  You can certainly
</I>&gt;<i> install your own versions of lua/luarocks or use another method if you like.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Best,
</I>&gt;&gt;<i> Bogdan
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Obviously much good work has gone into eLua by Bogdan and others for
</I>&gt;&gt;&gt;<i> which I am grateful and hope to return some value in the coming months.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Graham
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> eLua-dev mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">eLua-dev at lists.berlios.de</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">https://lists.berlios.de/mailman/listinfo/elua-dev</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> eLua-dev mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">eLua-dev at lists.berlios.de</A>
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">https://lists.berlios.de/mailman/listinfo/elua-dev</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> James Snyder
</I>&gt;<i> Biomedical Engineering
</I>&gt;<i> Northwestern University
</I>&gt;<i> <A HREF="http://fanplastic.org/key.txt">http://fanplastic.org/key.txt</A>
</I>&gt;<i> ph: (847) 448-0386
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> eLua-dev mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">eLua-dev at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">https://lists.berlios.de/mailman/listinfo/elua-dev</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/elua-dev/attachments/20130603/2b22dc46/attachment-0001.html">https://lists.berlios.de/pipermail/elua-dev/attachments/20130603/2b22dc46/attachment-0001.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004146.html">[eLua-dev] New to eLua and STM32F4xx
</A></li>
	<LI>Next message: <A HREF="004150.html">[eLua-dev] New to eLua and STM32F4xx
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4147">[ date ]</a>
              <a href="thread.html#4147">[ thread ]</a>
              <a href="subject.html#4147">[ subject ]</a>
              <a href="author.html#4147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/elua-dev">More information about the eLua-dev
mailing list</a><br>
</body></html>
