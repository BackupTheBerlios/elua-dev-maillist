<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [eLua-dev] elua serial console CRLF strange behaviour
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/elua-dev/2010-September/index.html" >
   <LINK REL="made" HREF="mailto:elua-dev%40lists.berlios.de?Subject=Re%3A%20%5BeLua-dev%5D%20elua%20serial%20console%20CRLF%20strange%20behaviour&In-Reply-To=%3CAANLkTimkyn2U%3DcbeOeeCbWm_Gx5jUz7EBR1agJ5ETkco%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001636.html">
   <LINK REL="Next"  HREF="001638.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[eLua-dev] elua serial console CRLF strange behaviour</H1>
    <B>Martin Guy</B> 
    <A HREF="mailto:elua-dev%40lists.berlios.de?Subject=Re%3A%20%5BeLua-dev%5D%20elua%20serial%20console%20CRLF%20strange%20behaviour&In-Reply-To=%3CAANLkTimkyn2U%3DcbeOeeCbWm_Gx5jUz7EBR1agJ5ETkco%40mail.gmail.com%3E"
       TITLE="[eLua-dev] elua serial console CRLF strange behaviour">martinwguy at gmail.com
       </A><BR>
    <I>Fri Sep  3 16:18:12 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001636.html">[eLua-dev] MMC cat
</A></li>
        <LI>Next message: <A HREF="001638.html">[eLua-dev] elua serial console CRLF strange behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1637">[ date ]</a>
              <a href="thread.html#1637">[ thread ]</a>
              <a href="subject.html#1637">[ subject ]</a>
              <a href="author.html#1637">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi
   I've been getting weird behaviour from elua when using the serial
console (shell) with minicom.  If I ended a line with the 'Enter' key,
I had to hit it twice to get one end-of-line. If instead I used line
feed (control-J), I har to hit it twice, but got two line feeds each
time, in pairs.
  The cause seems to be some strange CRLF/LFCR handling code in
newlib/genstd.c which, when it sees a carriage return or a newline,
reads another character, hoping to map CRLF or LFCR to LF.  When
presented with &quot;single&quot; CR or LF line terminators, as generated by all
known serial terminals, the behaviour becomes bizarre.

   I note in the web instructions that it recommends setting the
terminal emulator to send CRLF when you press Enter - but I've never
seen a physical serial terminal that does this, nor a terminal
emulator that does this.

   The attached patch simply maps CR or LF to '\n', in each case
echoing CRLF to the screen.  It also fixes a bug, whereby a UART
failure (overrun, parity error etc) would have returned an entire
buffer full of junk (it returns EOF instead).

   Are there really any situations where CRLF (and LFCR!) mapping on
serial input is necessary?

       M
-------------- next part --------------
A non-text attachment was scrubbed...
Name: elua-fix-stdin-crlf.patch
Type: text/x-patch
Size: 2593 bytes
Desc: not available
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/elua-dev/attachments/20100903/f707697c/attachment.bin">https://lists.berlios.de/pipermail/elua-dev/attachments/20100903/f707697c/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001636.html">[eLua-dev] MMC cat
</A></li>
	<LI>Next message: <A HREF="001638.html">[eLua-dev] elua serial console CRLF strange behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1637">[ date ]</a>
              <a href="thread.html#1637">[ thread ]</a>
              <a href="subject.html#1637">[ subject ]</a>
              <a href="author.html#1637">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/elua-dev">More information about the eLua-dev
mailing list</a><br>
</body></html>
