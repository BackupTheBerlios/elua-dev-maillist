<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [eLua-dev] What can I do?
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/elua-dev/2010-December/index.html" >
   <LINK REL="made" HREF="mailto:elua-dev%40lists.berlios.de?Subject=Re%3A%20%5BeLua-dev%5D%20What%20can%20I%20do%3F&In-Reply-To=%3CAANLkTimoB-4wod%2B1L8oLvyeTQwBm5yHqRJxwadkuPT-t%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001779.html">
   <LINK REL="Next"  HREF="001781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[eLua-dev] What can I do?</H1>
    <B>Bogdan Marinescu</B> 
    <A HREF="mailto:elua-dev%40lists.berlios.de?Subject=Re%3A%20%5BeLua-dev%5D%20What%20can%20I%20do%3F&In-Reply-To=%3CAANLkTimoB-4wod%2B1L8oLvyeTQwBm5yHqRJxwadkuPT-t%40mail.gmail.com%3E"
       TITLE="[eLua-dev] What can I do?">bogdan.marinescu at gmail.com
       </A><BR>
    <I>Wed Dec  8 13:42:47 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001779.html">[eLua-dev] What can I do?
</A></li>
        <LI>Next message: <A HREF="001781.html">[eLua-dev] What can I do?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1780">[ date ]</a>
              <a href="thread.html#1780">[ thread ]</a>
              <a href="subject.html#1780">[ subject ]</a>
              <a href="author.html#1780">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> I did spot a brief reference to that in the User Labs WiKi, but could not
</I>&gt;<i> find anything more about it - I'll have a poke around in the source code.
</I>&gt;<i> I'll not ask you to define &quot;soon&quot; - I've found that can be a dangerous
</I>&gt;<i> question to ask open source developers!
</I>
The full docs are already in trunk (doc/en/inthandlers.txt). And yes,
that is a dangerous question to ask, especially with the holidays
around the corner :) We plan to have something around Christmas, but
this might have been already delayed with me being busier than usual
at work and the other guys having their own set of time consuming
tasks.

&gt;<i> I do not think this will work - even if the &quot;select&quot; call is non-blocking,
</I>&gt;<i> unless the coroutine yields no more Lua code can execute.
</I>
Ah OK, we were talking about different things then. My idea was that
the coroutine was supposed to block for 100ms (for example) even if it
didn't have anything to do, then yield (thus partially scheduling
itself). Cooperative multitasking with time slots. You're right that
in this time no more Lua code can execute (except for Lua interrupt
handlers).

&gt;<i> We need to arrange
</I>&gt;<i> it such that the only code that may block is the scheduler - when it has no
</I>&gt;<i> more code ready to run it can block or busy-wait for a new event. The timer
</I>&gt;<i> expired call I mentioned in the original message was only an example of
</I>&gt;<i> using an enhanced coroutine yield to implement a non-blocking event wait -
</I>&gt;<i> it could have been any interrupt event.
</I>
I think I understood now. You are indeed looking for something that
should be implemented on the C side.

&gt;<i> Most of what I am suggesting could be done either in C or in Lua, but ISRs
</I>&gt;<i> have to be C and there has to be a way for ISR code to set a flag which can
</I>&gt;<i> be asynchronously read in Lua, on the fly without blocking.
</I>
If you need a flag in Lua wouldn't it be easier to have the interrupt
handler directly in Lua? Currently interrupt support in Lua is done
using standard Lua hooks, so as long as the VM is running you will get
to the interrupt handler no matter what. Of course the actual
interrupt handlers are written in C and the C code puts them in a
queue that is later examined by the Lua hook function :) but you might
not need to be disturbed with such details and use the Lua handlers
directly.

&gt;<i> Asynchronous
</I>&gt;<i> events must be generated by an ISR (and therefore in C code), though they
</I>&gt;<i> would not be limited to the interrupt flags specified by the hardware (for
</I>&gt;<i> example in serial comms data can be buffered by an ISR until a specified
</I>&gt;<i> packet termination criterion is met and then a flag is set in RAM to trigger
</I>&gt;<i> the scheduler to run some Lua code).
</I>
Yes, a software interrupt-on-UART-char-match (which is an instance of
what you described above) is already planned. Very useful for tasks
like reading sentences from a GPS receiver when an interrupt could be
generated when NL is received and the code could simply read the
sentence and parse it. There's a ton of cool stuff that can be done
with these &quot;software interrupts&quot; (which are actually semantically
similar to events).

&gt;<i> It might be useful to allow events to
</I>&gt;<i> be raised in Lua, but these would necessarily be synchronous events
</I>&gt;<i> conceptually equivalent to simple Boolean globals.
</I>
Yes, they are already asynchronous, as explained. The only real
limitation right now is the &quot;VM must run&quot; one. I don't know how to fix
this without multithreading support (actual threads, not Lua threads),
I'm not even sure it can be done. If the current model proves to be
too simple for practical uses I'll probably have to add a simple
threading library to eLua. But this is something I'll do only when I'm
convinced that there aren't other practical solutions to try.

Best,
Bogdan

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001779.html">[eLua-dev] What can I do?
</A></li>
	<LI>Next message: <A HREF="001781.html">[eLua-dev] What can I do?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1780">[ date ]</a>
              <a href="thread.html#1780">[ thread ]</a>
              <a href="subject.html#1780">[ subject ]</a>
              <a href="author.html#1780">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/elua-dev">More information about the eLua-dev
mailing list</a><br>
</body></html>
