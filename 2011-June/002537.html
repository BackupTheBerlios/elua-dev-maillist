<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [eLua-dev] eLua-dev Digest, Vol 35, Issue 41
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/elua-dev/2011-June/index.html" >
   <LINK REL="made" HREF="mailto:elua-dev%40lists.berlios.de?Subject=Re%3A%20%5BeLua-dev%5D%20eLua-dev%20Digest%2C%20Vol%2035%2C%20Issue%2041&In-Reply-To=%3CBANLkTikrVBDtcUVLP3JGh5_B4dM29piyrw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002535.html">
   <LINK REL="Next"  HREF="002538.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[eLua-dev] eLua-dev Digest, Vol 35, Issue 41</H1>
    <B>Raman Gopalan</B> 
    <A HREF="mailto:elua-dev%40lists.berlios.de?Subject=Re%3A%20%5BeLua-dev%5D%20eLua-dev%20Digest%2C%20Vol%2035%2C%20Issue%2041&In-Reply-To=%3CBANLkTikrVBDtcUVLP3JGh5_B4dM29piyrw%40mail.gmail.com%3E"
       TITLE="[eLua-dev] eLua-dev Digest, Vol 35, Issue 41">ramangopalan at gmail.com
       </A><BR>
    <I>Fri Jun 17 17:40:40 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002535.html">[eLua-dev] eLua-dev Digest, Vol 35, Issue 34
</A></li>
        <LI>Next message: <A HREF="002538.html">[eLua-dev] eLua-dev Digest, Vol 35, Issue 41
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2537">[ date ]</a>
              <a href="thread.html#2537">[ thread ]</a>
              <a href="subject.html#2537">[ subject ]</a>
              <a href="author.html#2537">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Jun 17, 2011 at 12:00 PM, &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">elua-dev-request at lists.berlios.de</A>&gt; wrote:

&gt;<i> Send eLua-dev mailing list submissions to
</I>&gt;<i>        <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">elua-dev at lists.berlios.de</A>
</I>&gt;<i>
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>        <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">https://lists.berlios.de/mailman/listinfo/elua-dev</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i>        <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">elua-dev-request at lists.berlios.de</A>
</I>&gt;<i>
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i>        <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">elua-dev-owner at lists.berlios.de</A>
</I>&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of eLua-dev digest...&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Today's Topics:
</I>&gt;<i>
</I>&gt;<i>   1. Re: eLua-dev Digest, Vol 35, Issue 34 (James Snyder)
</I>&gt;<i>   2. Re: Redefining the I2C Lua interface (was: I2C for LM3S
</I>&gt;<i>      devices) (Martin Guy)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Thu, 16 Jun 2011 16:06:57 -0500
</I>&gt;<i> From: James Snyder &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">jbsnyder at fanplastic.org</A>&gt;
</I>&gt;<i> To: &quot;eLua Users and Development List (www.eluaproject.net)&quot;
</I>&gt;<i>        &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">elua-dev at lists.berlios.de</A>&gt;
</I>&gt;<i> Subject: Re: [eLua-dev] eLua-dev Digest, Vol 35, Issue 34
</I>&gt;<i> Message-ID: &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">BANLkTim6e-PpT1ayjMhXUe+f7MzoXJcA3A at mail.gmail.com</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=ISO-8859-1
</I>&gt;<i>
</I>&gt;<i> On Wed, Jun 15, 2011 at 5:32 AM, Raman Gopalan &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">ramangopalan at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; Thanks for your reply. Now that I know for sure that the bug has nothing
</I>&gt;<i> &gt; to do with my platform setup, I will try to build up test cases to corner
</I>&gt;<i> &gt; the
</I>&gt;<i> &gt; bug. I will keep the posix vs win serial implementation in mind. If I
</I>&gt;<i> &gt; stumble
</I>&gt;<i> &gt; upon something interesting, I will certainly keep the community posted.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Awaiting your update.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Raman
</I>&gt;<i>
</I>
Hello,

&gt;<i>
</I>&gt;<i> What's odd here is that I did hook up a scope to both Rx and Tx lines
</I>&gt;<i> and at least at the MCU it appears to be sending back the initial
</I>&gt;<i> handshake reply.
</I>&gt;<i>
</I>
Sure, I too was able to confirm this with stub code.


&gt;<i> What I can't figure out is why it never appears in
</I>&gt;<i> the buffer in Windows.  There's plenty of buffer space allocated
</I>&gt;<i> beforehand.  One difference I notice in timing between POSIX and
</I>&gt;<i> Windows is that it seems to send the connection request byte and
</I>&gt;<i> header as one &quot;packet&quot; whereas with windows there is a couple
</I>&gt;<i> millisecond delay between the sending of the connection request byte
</I>&gt;<i> and the 8 header bytes.  Additionally, there appears to be a longer
</I>&gt;<i> delay in responding to the single 9 byte POSIX send vs the separated
</I>&gt;<i> Windows 1 + 2ms + 8 byte send.  I haven't looked at timing on an STM32
</I>&gt;<i> platform yet to see how it differs if at all but I wonder if this
</I>&gt;<i> might be related to timing?
</I>&gt;<i>
</I>
Certainly, there is a very good possibility of the problem emanating from
the
delta delay. I have also obtained &quot;MY ERROR: header exchange failed&quot; in
addition to the &quot;no data received when attempting to read&quot; error.

I have also tried building on Gnu/Linux. The response is identical. The
./luarpc
instance, while executing rpc.connect(&quot;/dev/ttyUSB0&quot;) takes me to an
infinite
waiting state. (Despite its posix compliance, which was tested successfully
on mac ?)

Have you encountered this before ?

&gt;<i>
</I>&gt;<i> It has definitely worked in the past on this platform.  I may start
</I>&gt;<i> trying to find the last working version and then use git bisect to
</I>&gt;<i> find what change caused the current problem.
</I>&gt;<i>
</I>
Awaiting your response.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 2
</I>&gt;<i> Date: Fri, 17 Jun 2011 02:40:32 +0200
</I>&gt;<i> From: Martin Guy &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">martinwguy at gmail.com</A>&gt;
</I>&gt;<i> To: Bogdan Marinescu &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">bogdan.marinescu at gmail.com</A>&gt;
</I>&gt;<i> Cc: &quot;eLua Users and Development List \(www.eluaproject.net\)&quot;
</I>&gt;<i>        &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">elua-dev at lists.berlios.de</A>&gt;
</I>&gt;<i> Subject: Re: [eLua-dev] Redefining the I2C Lua interface (was: I2C for
</I>&gt;<i>        LM3S    devices)
</I>&gt;<i> Message-ID: &lt;BANLkTi=<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">zJgtXNc1B5L+eiQw8_N116YX1Lg at mail.gmail.com</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=ISO-8859-1
</I>&gt;<i>
</I>&gt;<i> On 16 June 2011 19:20, Bogdan Marinescu &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">bogdan.marinescu at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; In one of my applications I actually read the
</I>&gt;<i> &gt; whole content of a serial EEPROM (32KB (not Kb)) into a file in the
</I>&gt;<i> &gt; filesystem. Reading the whole data and writing it in one step is simply
</I>&gt;<i> not
</I>&gt;<i> &gt; good enough because I'd need too much memory for the operation, so
</I>&gt;<i> instead
</I>&gt;<i> &gt; I'm reading it in chunks of 256 bytes.
</I>&gt;<i>
</I>&gt;<i> Thanks.  Yes, you would need to do the reading of the blocks at Lua
</I>&gt;<i> level as separate I2C transactions as you describe.
</I>&gt;<i>
</I>&gt;<i> &gt; I just feel that the I2C
</I>&gt;<i> &gt; interface introduces limitations that shouldn't be there ...
</I>&gt;<i>
</I>&gt;<i> The advantage of making the eLua APIs match the I2C protocol
</I>&gt;<i> definition is that you can be sure to implement the API on any
</I>&gt;<i> hardware, can be sure to drive any device, and be sure that users can
</I>&gt;<i> only talk valid I2C language, however they call it.
</I>&gt;<i> It's also a way of teaching learners exactly what valid I2C protocol means.
</I>&gt;<i>
</I>&gt;<i> I'm working on the assumption that modelling the eLua APIs on the I2C
</I>&gt;<i> specification is the best way to guarantee that we will be able to
</I>&gt;<i> drive all master interfaces and talk to all slave devices, including
</I>&gt;<i> those we do not know, or that have not been produced yet.
</I>&gt;<i>
</I>&gt;<i> On one hand, the spec does say that I2C does not impose a limit on the
</I>&gt;<i> amount of data present in one transfer.
</I>&gt;<i> On the other, ir doesn't say that it's mandatory for a master to be
</I>&gt;<i> able to handle infinite length transfers.
</I>&gt;<i>
</I>&gt;<i> &gt; Absolutely. I'm not using EEPROM as an example because I want to model
</I>&gt;<i> our
</I>&gt;<i> &gt; I2C platform interface after it, it's just an use case I'm quite familiar
</I>&gt;<i> &gt; with in practice and I can use it to detect limitations in our interface.
</I>&gt;<i> So
</I>&gt;<i> &gt; far it's doing a pretty good job :)
</I>&gt;<i>
</I>&gt;<i> I confess that starting a 32-megabyte transfer in one function call,
</I>&gt;<i> then reading the data of one packet in 256-bytes chunks with separate
</I>&gt;<i> function calls is not a usage scenario that I had thought of.
</I>&gt;<i>
</I>&gt;<i> Here's another nightmare for you. I just found a device that eats
</I>&gt;<i> infinite-length data packets for lunch.
</I>&gt;<i> It's an 8-bit ADC/DAC device
</I>&gt;<i> <A HREF="http://www.nxp.com/documents/data_sheet/PCF8591.pdf">http://www.nxp.com/documents/data_sheet/PCF8591.pdf</A>
</I>&gt;<i> that can perform both analog-to-digital or digital-to-analog
</I>&gt;<i> conversion in the same time it takes to transmit or receive one byte
</I>&gt;<i> and it can send you an infinite amount of data, or you can send *it*
</I>&gt;<i> an infinite amount of data in one I2C read or write packet, assuming
</I>&gt;<i> that you can consume or generate it fast enough: one sample every
</I>&gt;<i> 90us, i.e. every nine 100kHz bus clocks == 11,111 samples per second.
</I>&gt;<i> To do audio, you'd have to be able to make a Lua-to-C-to-Lua
</I>&gt;<i> transition in 90 us so as not have glitches in the output or miss
</I>&gt;<i> samples on input. At 100 MHz CPU clock and 4 cycles per instruction,
</I>&gt;<i> that's something like 250 instructions, which sounds possible in
</I>&gt;<i> assembler. Could you make a round trip from the Lua interpreter to C
</I>&gt;<i> and back in that sort of time and do something useful with the data?
</I>&gt;<i> Would you want to? :)
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; My own problem with i2c.probe(id, address) is that AVR32 cannot send
</I>&gt;<i> &gt;&gt; empty data packets.
</I>&gt;<i>
</I>&gt;<i> &gt; This is getting ridiculous. At this point I wish they kept the I2C engine
</I>&gt;<i> &gt; from their 8 bit AVR MCU line. Besides not being able to to DMA transfers
</I>&gt;<i> &gt; (although I'm not sure if this is still true for XMEGAs) it was much
</I>&gt;<i> better
</I>&gt;<i> &gt; than what they offer in the AVR32 IMO.
</I>&gt;<i>
</I>&gt;<i> It gets worse. A different ADC instead
</I>&gt;<i> <A HREF="http://www.ti.com/lit/gpn/ads7823">http://www.ti.com/lit/gpn/ads7823</A>
</I>&gt;<i> when you just send it a single zero data byte, that means &quot;power up
</I>&gt;<i> and convert 4 samples from analog to digital&quot;.  I suppose, as it's a
</I>&gt;<i> slave device, that one case is harmess, but what might other devices
</I>&gt;<i> do?  Anyway, there's nothing I can do about that.
</I>&gt;<i>
</I>&gt;<i> The only difference the AVR32 limitation makes to us is that it
</I>&gt;<i> suggests adding i2c_master_probe( id, slave_address ) to the C
</I>&gt;<i> platform interface, so that AVR32 can do it's brain-damaged thing
</I>&gt;<i> sending a 0 byte, while allowing other platform can do something more
</I>&gt;<i> healthy.  If that were implemented at a higher level as send(id,
</I>&gt;<i> address, NULL, 0, true), the AVR32 would have to either fail that
</I>&gt;<i> always because it can't do it (making probe() unusable) or send a
</I>&gt;<i> single zero data byte when the user asked for none. I'm not sure which
</I>&gt;<i> is worse.
</I>&gt;<i>
</I>&gt;<i> I guess that's why they call it TWI, not I2C.  Unfortunately, I have
</I>&gt;<i> this to work with :(
</I>&gt;<i>
</I>&gt;<i> Is it too much to limit the data transfer size to the RAM you want to
</I>&gt;<i> dedicate to one message?
</I>&gt;<i> Implementing a multi-function stop-and-go interface frightens me.
</I>&gt;<i>
</I>&gt;<i>   M
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> eLua-dev mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">eLua-dev at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/elua-dev">https://lists.berlios.de/mailman/listinfo/elua-dev</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> End of eLua-dev Digest, Vol 35, Issue 41
</I>&gt;<i> ****************************************
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/elua-dev/attachments/20110617/60dc33fe/attachment.html">https://lists.berlios.de/pipermail/elua-dev/attachments/20110617/60dc33fe/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002535.html">[eLua-dev] eLua-dev Digest, Vol 35, Issue 34
</A></li>
	<LI>Next message: <A HREF="002538.html">[eLua-dev] eLua-dev Digest, Vol 35, Issue 41
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2537">[ date ]</a>
              <a href="thread.html#2537">[ thread ]</a>
              <a href="subject.html#2537">[ subject ]</a>
              <a href="author.html#2537">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/elua-dev">More information about the eLua-dev
mailing list</a><br>
</body></html>
